<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
      :root {
        --brand-a: #2563eb;
        --brand-b: #7c3aed;
        --soft-bg: #f8fafc;
      }

      body {
        background: radial-gradient(circle at top left, #eff6ff, #f8fafc 35%, #ffffff 80%);
      }

      .hero {
        background: linear-gradient(120deg, var(--brand-a), var(--brand-b));
        color: #fff;
        border-radius: 1rem;
        overflow: hidden;
        position: relative;
      }

      .hero::after {
        content: '';
        position: absolute;
        width: 220px;
        height: 220px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.15);
        right: -70px;
        top: -70px;
        animation: floatBubble 6s ease-in-out infinite;
      }

      @keyframes floatBubble {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(12px);
        }
      }

      .glass-card {
        background: rgba(255, 255, 255, 0.78);
        backdrop-filter: blur(6px);
        border: 1px solid rgba(148, 163, 184, 0.3);
        border-radius: 1rem;
      }

      .floating-card {
        transition: transform 0.25s ease, box-shadow 0.25s ease;
      }

      .floating-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 14px 34px rgba(37, 99, 235, 0.14);
      }

      .metric-tile {
        border-radius: 0.9rem;
        background: #ffffff;
        border: 1px solid #e2e8f0;
        padding: 1rem;
      }

      .section-title {
        font-weight: 700;
        letter-spacing: 0.2px;
      }

      .pulse-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: #22c55e;
        animation: pulseDot 1.6s infinite;
      }

      @keyframes pulseDot {
        0% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.5);
        }
        70% {
          transform: scale(1.05);
          box-shadow: 0 0 0 10px rgba(34, 197, 94, 0);
        }
        100% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
        }
      }

      .submission-list {
        max-height: 420px;
        overflow: auto;
      }

      @media (max-width: 767px) {
        .hero h1 {
          font-size: 1.45rem;
        }
      }
    </style>
  </head>
  <body>
    <main class="container py-4 py-md-5">
      <section class="hero p-4 p-md-5 mb-4 mb-md-5 shadow-lg">
        <div class="row align-items-center g-4">
          <div class="col-lg-8 position-relative">
            <p class="mb-2 text-uppercase small fw-semibold opacity-75">Advanced styling demo</p>
            <h1 class="mb-3"><%= title %></h1>
            <p class="mb-0 opacity-90">
              Responsive layout with Bootstrap grid, custom transitions/animations, and server-rendered validation status.
            </p>
          </div>
          <div class="col-lg-4">
            <div class="glass-card p-3 p-md-4 text-dark floating-card">
              <div class="d-flex align-items-center gap-2 mb-2">
                <span class="pulse-dot"></span>
                <span class="fw-semibold">Live Session Metrics</span>
              </div>
              <div class="small text-secondary">Temporary in-memory storage, reset on server restart.</div>
              <hr class="my-3" />
              <div class="d-flex justify-content-between">
                <span>Total records</span>
                <strong><%= submissions.length %></strong>
              </div>
              <div class="d-flex justify-content-between mt-2">
                <span>Profiles</span>
                <strong><%= profileCount %></strong>
              </div>
              <div class="d-flex justify-content-between mt-2">
                <span>Feedback</span>
                <strong><%= feedbackCount %></strong>
              </div>
            </div>
          </div>
        </div>
      </section>

      <% if (statusMessage) { %>
        <div class="alert alert-info border-0 shadow-sm" role="alert">
          <%= statusMessage %>
        </div>
      <% } %>

      <section class="row g-3 g-md-4 mb-4">
        <div class="col-6 col-md-3">
          <div class="metric-tile floating-card h-100">
            <div class="text-secondary small">Responsive Grid</div>
            <div class="fw-bold fs-5">Bootstrap 5</div>
          </div>
        </div>
        <div class="col-6 col-md-3">
          <div class="metric-tile floating-card h-100">
            <div class="text-secondary small">Client Validation</div>
            <div class="fw-bold fs-5">Inline JS</div>
          </div>
        </div>
        <div class="col-6 col-md-3">
          <div class="metric-tile floating-card h-100">
            <div class="text-secondary small">Server Validation</div>
            <div class="fw-bold fs-5">Express</div>
          </div>
        </div>
        <div class="col-6 col-md-3">
          <div class="metric-tile floating-card h-100">
            <div class="text-secondary small">UX Effects</div>
            <div class="fw-bold fs-5">Animations</div>
          </div>
        </div>
      </section>

      <section class="row g-4 mb-4">
        <div class="col-lg-6">
          <form action="/submit-profile" method="POST" onsubmit="return validateProfileForm(event)" class="card border-0 shadow-sm h-100 floating-card">
            <div class="card-body p-4">
              <h2 class="h4 section-title mb-3">Profile Form</h2>

              <label for="fullName" class="form-label">Full Name</label>
              <input id="fullName" name="fullName" type="text" required minlength="3" maxlength="60" class="form-control" />

              <label for="email" class="form-label mt-3">Email</label>
              <input id="email" name="email" type="email" required class="form-control" />

              <div class="row g-3 mt-1">
                <div class="col-sm-6">
                  <label for="age" class="form-label">Age</label>
                  <input id="age" name="age" type="number" required min="13" max="120" class="form-control" />
                </div>
                <div class="col-sm-6">
                  <label for="favoriteColor" class="form-label">Favorite Color</label>
                  <input id="favoriteColor" name="favoriteColor" type="color" required value="#1d4ed8" class="form-control form-control-color w-100" oninput="document.getElementById('colorPreview').textContent=this.value" />
                  <div id="colorPreview" class="small text-primary mt-1">#1d4ed8</div>
                </div>
              </div>

              <label for="bio" class="form-label mt-3">Short Bio (10-200 chars)</label>
              <textarea id="bio" name="bio" rows="4" required minlength="10" maxlength="200" class="form-control"></textarea>

              <div class="form-check mt-3">
                <input id="newsletter" name="newsletter" type="checkbox" class="form-check-input" />
                <label for="newsletter" class="form-check-label">Subscribe to newsletter updates</label>
              </div>

              <p id="profileError" class="text-danger small mt-2 mb-0"></p>
              <button type="submit" class="btn btn-primary w-100 mt-3">Submit Profile</button>
            </div>
          </form>
        </div>

        <div class="col-lg-6">
          <form action="/submit-feedback" method="POST" onsubmit="return validateFeedbackForm(event)" class="card border-0 shadow-sm h-100 floating-card">
            <div class="card-body p-4">
              <h2 class="h4 section-title mb-3">Feedback Form</h2>

              <label for="topic" class="form-label">Topic</label>
              <select id="topic" name="topic" required class="form-select">
                <option value="">Select one...</option>
                <option value="Website">Website</option>
                <option value="Support">Support</option>
                <option value="Feature Request">Feature Request</option>
                <option value="Other">Other</option>
              </select>

              <label for="message" class="form-label mt-3">Message (15-500 chars)</label>
              <textarea id="message" name="message" rows="4" required minlength="15" maxlength="500" class="form-control" oninput="handleMessageInput(this.value)"></textarea>
              <div id="messageCounter" class="small text-secondary mt-1">0 / 500</div>

              <div class="rounded border bg-light p-2 mt-2">
                <div class="small fw-semibold">AI Hints (local heuristic)</div>
                <div class="small">Suggested Sentiment: <span id="aiSentimentHint" class="fw-bold">Neutral</span></div>
                <div class="small">Suggested Topic: <span id="aiTopicHint" class="fw-bold">Other</span></div>
              </div>

              <fieldset class="mt-3 border rounded p-2">
                <legend class="float-none w-auto px-1 fs-6 mb-1">Sentiment</legend>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="sentiment" value="Positive" required id="sentimentPositive" />
                  <label class="form-check-label" for="sentimentPositive">Positive</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="sentiment" value="Neutral" required id="sentimentNeutral" />
                  <label class="form-check-label" for="sentimentNeutral">Neutral</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="sentiment" value="Negative" required id="sentimentNegative" />
                  <label class="form-check-label" for="sentimentNegative">Negative</label>
                </div>
              </fieldset>

              <label for="contactTime" class="form-label mt-3">Preferred Contact Time</label>
              <select id="contactTime" name="contactTime" required class="form-select">
                <option value="Morning">Morning</option>
                <option value="Afternoon">Afternoon</option>
                <option value="Evening">Evening</option>
              </select>

              <label for="rating" class="form-label mt-3">Rating (1-5)</label>
              <input id="rating" name="rating" type="range" min="1" max="5" value="3" class="form-range" oninput="document.getElementById('ratingValue').textContent=this.value" />
              <div class="small">Selected: <strong id="ratingValue">3</strong></div>

              <p id="feedbackError" class="text-danger small mt-2 mb-0"></p>
              <button type="submit" class="btn btn-success w-100 mt-3">Submit Feedback</button>
            </div>
          </form>
        </div>
      </section>

      <section class="card border-0 shadow-sm floating-card">
        <div class="card-body p-4">
          <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
            <h2 class="h4 mb-0 section-title">Validated Data (Temporary Server Storage)</h2>
            <span class="badge text-bg-secondary">Newest first · max 50 rows</span>
          </div>

          <% if (!submissions.length) { %>
            <p class="mb-0 text-secondary">No submissions yet.</p>
          <% } else { %>
            <div class="submission-list">
              <div class="list-group">
                <% submissions.forEach((entry) => { %>
                  <div class="list-group-item py-3">
                    <div class="d-flex justify-content-between flex-wrap gap-2 mb-1">
                      <strong><%= entry.formType %></strong>
                      <span class="text-secondary small"><%= entry.createdAt %></span>
                    </div>

                    <% if (entry.formType === 'Profile') { %>
                      <div class="small">
                        Name: <strong><%= entry.fullName %></strong> · Email: <%= entry.email %> · Age: <%= entry.age %> · Color: <%= entry.favoriteColor %> · Newsletter: <%= entry.newsletter ? 'Yes' : 'No' %>
                      </div>
                    <% } else { %>
                      <div class="small">
                        Topic: <strong><%= entry.topic %></strong> · Sentiment: <%= entry.sentiment %> · Contact: <%= entry.contactTime %> · Rating: <%= entry.rating %>/5
                      </div>
                      <div class="small text-secondary mt-1">
                        AI Hints → Topic: <%= entry.aiTopicHint %> · Sentiment: <%= entry.aiSentimentHint %>
                      </div>
                      <div class="small mt-1">Message: <%= entry.message %></div>
                    <% } %>
                  </div>
                <% }); %>
              </div>
            </div>
          <% } %>
        </div>
      </section>
    </main>

    <script>
      function getLocalAiHints(message) {
        const lower = message.toLowerCase();

        const sentiment =
          /great|awesome|love|amazing|excellent|smooth/.test(lower)
            ? 'Positive'
            : /bad|hate|broken|slow|bug|problem|issue|angry/.test(lower)
              ? 'Negative'
              : 'Neutral';

        const topic =
          /support|help|ticket|agent/.test(lower)
            ? 'Support'
            : /feature|request|idea|add|improve/.test(lower)
              ? 'Feature Request'
              : /ui|ux|page|website|design|layout/.test(lower)
                ? 'Website'
                : 'Other';

        return { sentiment, topic };
      }

      function handleMessageInput(value) {
        document.getElementById('messageCounter').textContent = value.length + ' / 500';

        const hint = getLocalAiHints(value);
        document.getElementById('aiSentimentHint').textContent = hint.sentiment;
        document.getElementById('aiTopicHint').textContent = hint.topic;
      }

      function validateProfileForm(event) {
        const form = event.target;
        const errorElement = document.getElementById('profileError');
        errorElement.textContent = '';

        const fullName = form.fullName.value.trim();
        const email = form.email.value.trim();
        const age = Number.parseInt(form.age.value, 10);
        const bio = form.bio.value.trim();

        if (fullName.length < 3 || fullName.length > 60) {
          errorElement.textContent = 'Full name must be 3 to 60 characters.';
          return false;
        }

        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          errorElement.textContent = 'Please enter a valid email address.';
          return false;
        }

        if (!Number.isInteger(age) || age < 13 || age > 120) {
          errorElement.textContent = 'Age must be between 13 and 120.';
          return false;
        }

        if (bio.length < 10 || bio.length > 200) {
          errorElement.textContent = 'Bio must be 10 to 200 characters.';
          return false;
        }

        return true;
      }

      function validateFeedbackForm(event) {
        const form = event.target;
        const errorElement = document.getElementById('feedbackError');
        errorElement.textContent = '';

        const topic = form.topic.value;
        const message = form.message.value.trim();
        const selectedSentiment = form.sentiment.value;
        const rating = Number.parseInt(form.rating.value, 10);

        if (!topic) {
          errorElement.textContent = 'Please choose a topic.';
          return false;
        }

        if (message.length < 15 || message.length > 500) {
          errorElement.textContent = 'Message must be 15 to 500 characters.';
          return false;
        }

        if (!selectedSentiment) {
          errorElement.textContent = 'Please select sentiment.';
          return false;
        }

        if (!Number.isInteger(rating) || rating < 1 || rating > 5) {
          errorElement.textContent = 'Rating must be between 1 and 5.';
          return false;
        }

        return true;
      }
    </script>
  </body>
</html>
